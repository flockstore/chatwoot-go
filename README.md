# chatwoot-go

Autogenerated Go client library for Chatwoot API.

This repository provides:

- Upstream spec synchronization from Chatwoot (`swagger/swagger.json`)
- Validation and normalization of OpenAPI 3 JSON
- Go client generation from the normalized OpenAPI 3 spec
- Daily GitHub Actions job that checks upstream and opens a PR with updates

## Files

- `cmd/specsync/main.go`: Fetches upstream spec, normalizes to OpenAPI 3, and writes commit state.
- `specs/chatwoot.openapi.json`: Normalized OpenAPI 3 spec (generated).
- `specs/.upstream.sha`: Last processed upstream commit SHA for `swagger/swagger.json` (generated).
- `oapi-codegen.yaml`: Go client generation config.
- `client/chatwoot.gen.go`: Generated Go client.
- `.github/workflows/update-chatwoot-client.yml`: Daily auto-update workflow + auto PR creation.

## Generate locally

Requirements:

- Go 1.22+

Run:

```bash
make generate
```

This will:

1. Fetch upstream Chatwoot spec.
2. Validate and normalize OpenAPI 3 input.
3. Generate `client/chatwoot.gen.go`.

## Daily auto-update

GitHub Actions workflow:

- Triggered daily (`cron: 17 4 * * *`) and on manual dispatch.
- Regenerates spec + client.
- If files changed, opens a PR using `peter-evans/create-pull-request`.

No PR is opened when there are no changes.

## Use the generated client

```go
package main

import (
	"context"
	"log"
	"net/http"

	chatwoot "github.com/ianfedev/antigravity/chatwoot-go/client"
)

func main() {
	api, err := chatwoot.NewClientWithResponses(
		"https://app.chatwoot.com",
		chatwoot.WithRequestEditorFn(func(ctx context.Context, req *http.Request) error {
			req.Header.Set("api_access_token", "YOUR_TOKEN")
			return nil
		}),
	)
	if err != nil {
		log.Fatal(err)
	}

	_ = api
}
```

## Notes

- This generator only supports OpenAPI 3.x input.
- If you fork this repo, update the module path in `go.mod` and import path examples in this README.
